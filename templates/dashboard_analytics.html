{% extends 'base.html' %}
{% load static %}

{% block title %}Analytics - Obidon Admin{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="admin-container">
    <!-- Sidebar (m√™me que dashboard.html) -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <h3>Admin Panel</h3>
            <p>Bienvenue, {{ user.first_name|default:user.username }}</p>
        </div>
        
        <nav class="sidebar-nav">
            <a href="{% url 'dashboard' %}" class="nav-item">
                <i class="fas fa-chart-line"></i> Dashboard
            </a>
            <a href="{% url 'dashboard_analytics' %}" class="nav-item active">
                <i class="fas fa-chart-bar"></i> Analytics
            </a>
            <a href="/admin/core/product/" class="nav-item">
                <i class="fas fa-boxes"></i> Produits
            </a>
            <a href="/admin/core/category/" class="nav-item">
                <i class="fas fa-tag"></i> Cat√©gories
            </a>
            <a href="/admin/core/order/" class="nav-item">
                <i class="fas fa-shopping-cart"></i> Commandes
            </a>
            <a href="/admin/core/review/" class="nav-item">
                <i class="fas fa-star"></i> Avis
            </a>
            <a href="/admin/auth/user/" class="nav-item">
                <i class="fas fa-users"></i> Utilisateurs
            </a>
            <hr class="sidebar-divider">
            <a href="/admin/" class="nav-item">
                <i class="fas fa-cog"></i> Admin Django
            </a>
            <a href="{% url 'home' %}" class="nav-item">
                <i class="fas fa-home"></i> Site
            </a>
            <a href="{% url 'account_logout' %}" class="nav-item logout">
                <i class="fas fa-sign-out-alt"></i> D√©connexion
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <div class="admin-header">
            <h1>Analytics & Insights</h1>
            <p class="text-muted">Analyse d√©taill√©e de vos performances</p>
        </div>

        <!-- Key Metrics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <h4>Total Clients</h4>
                    <p class="stat-value">{{ total_customers }}</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i class="fas fa-user-plus"></i>
                </div>
                <div class="stat-content">
                    <h4>Nouveaux Clients (30j)</h4>
                    <p class="stat-value">{{ new_customers }}</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <i class="fas fa-shopping-bag"></i>
                </div>
                <div class="stat-content">
                    <h4>Panier Moyen</h4>
                    <p class="stat-value">${{ avg_order_value|floatformat:2 }}</p>
                </div>
            </div>
        </div>

        <!-- Best Rated Products -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3>‚≠ê Produits Mieux Not√©s</h3>
            </div>
            <div class="analytics-list">
                {% for product in best_rated %}
                <div class="analytics-item">
                    <div class="item-info">
                        <h5>{{ product.name }}</h5>
                        <p class="text-muted">{{ product.category.name }}</p>
                    </div>
                    <div class="item-stats">
                        <div class="rating">
                            {% for i in "12345" %}
                                {% if forloop.counter <= product.rating %}
                                <i class="fas fa-star" style="color: #ffc107;"></i>
                                {% else %}
                                <i class="fas fa-star" style="color: #ddd;"></i>
                                {% endif %}
                            {% endfor %}
                            <span>({{ product.rating }}/5 - {{ product.reviews_count }} avis)</span>
                        </div>
                        <a href="/admin/core/product/{{ product.id }}/change/" class="btn-link">√âditer ‚Üí</a>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted">Aucun produit √©valu√©</p>
                {% endfor %}
            </div>
        </div>

        <!-- Most Reviewed Products -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3>üí¨ Produits Mieux Comment√©s</h3>
            </div>
            <div class="analytics-list">
                {% for product in most_reviewed %}
                <div class="analytics-item">
                    <div class="item-info">
                        <h5>{{ product.name }}</h5>
                        <p class="text-muted">{{ product.category.name }}</p>
                    </div>
                    <div class="item-stats">
                        <span class="badge" style="background: #17a2b8; color: white;">{{ product.reviews.all|length }} avis</span>
                        <a href="/admin/core/product/{{ product.id }}/change/" class="btn-link">√âditer ‚Üí</a>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted">Aucun avis</p>
                {% endfor %}
            </div>
        </div>

        <!-- Performance Tips -->
        <div class="dashboard-card full-width">
            <div class="card-header">
                <h3>üìä Conseils de Performance</h3>
            </div>
            <div class="tips-grid">
                <div class="tip-card">
                    <i class="fas fa-lightbulb" style="color: #ffc107; font-size: 24px;"></i>
                    <h5>Optimiser le Stock</h5>
                    <p>V√©rifiez r√©guli√®rement vos niveaux de stock pour √©viter les ruptures.</p>
                </div>
                <div class="tip-card">
                    <i class="fas fa-picture-o" style="color: #17a2b8; font-size: 24px;"></i>
                    <h5>Ajouter des Images</h5>
                    <p>Les produits avec plusieurs images ont de meilleursprix de conversion.</p>
                </div>
                <div class="tip-card">
                    <i class="fas fa-comments" style="color: #28a745; font-size: 24px;"></i>
                    <h5>Encourager les Avis</h5>
                    <p>Les avis clients augmentent la confiance et les ventes.</p>
                </div>
                <div class="tip-card">
                    <i class="fas fa-tags" style="color: #ff6a88; font-size: 24px;"></i>
                    <h5>Promouvoir les R√©ductions</h5>
                    <p>Les produits en promotion augmentent vos ventes saisonni√®res.</p>
                </div>
            </div>
        </div>
    </main>
</div>
{% endblock %}

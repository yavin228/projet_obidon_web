{% extends "base.html" %}
{% load static %}

{% block title %}{{ product.name }} - Obidon{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/reviews.css' %}">
    <style>
        /* Styles pour l'effet hover recto/verso */
        .product-image-hover-container {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .product-image-hover {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .product-image-hover img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s ease, transform 0.8s ease;
            backface-visibility: hidden;
        }

        .product-image-hover .front-image {
            opacity: 1;
            transform: translateY(0);
            z-index: 2;
        }

        .product-image-hover .back-image {
            opacity: 0;
            transform: translateY(20px);
            z-index: 1;
            border: 2px solid #D4AF37;
        }

        .product-image-hover.has-back-image:hover .front-image {
            opacity: 0;
            transform: translateY(-20px);
        }

        .product-image-hover.has-back-image:hover .back-image {
            opacity: 1;
            transform: translateY(0);
        }

        .hover-indicator {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(212, 175, 55, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 3;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .product-image-hover.has-back-image:hover .hover-indicator {
            opacity: 1;
        }

        .hover-indicator i {
            font-size: 10px;
        }

        .image-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        .image-legend span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .legend-front {
            background-color: #5D4037;
        }

        .legend-back {
            background-color: #D4AF37;
        }
    </style>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/reviews.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="product-detail-page">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="{% url 'home' %}">Accueil</a>
        <span>/</span>
        <a href="{% url 'products' %}">Produits</a>
        <span>/</span>
        <a href="{% url 'products' %}?category={{ product.category.id }}">{{ product.category.name }}</a>
        <span>/</span>
        <span>{{ product.name }}</span>
    </div>

    <div class="product-detail-wrapper">
        <!-- Product Gallery -->
        <div class="product-gallery">
            <!-- Image principale avec effet hover -->
            <div class="product-image-hover-container">
                <div class="product-image-hover {% if product.back_image %}has-back-image{% endif %}">
                    <!-- Image recto -->
                    <img 
                        id="mainProductImage"
                        src="{{ product.get_image_url }}" 
                        alt="{{ product.name }}" 
                        class="front-image"
                        loading="lazy"
                    >
                    
                    <!-- Image verso (si elle existe) -->
                    {% if product.back_image %}
                        <img 
                            src="{{ product.get_back_image_url }}" 
                            alt="{{ product.name }} - verso" 
                            class="back-image"
                            loading="lazy"
                        >
                        <div class="hover-indicator">
                            <i class="fas fa-sync-alt"></i> Survolez pour voir le verso
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Miniatures en dessous (thumbnails) -->
            <div class="thumbnails">
                <!-- Image principale en miniature -->
                <img 
                    src="{{ product.get_thumbnail_url }}" 
                    alt="{{ product.name }} - recto"
                    class="thumbnail active"
                    data-full="{{ product.get_image_url }}"
                    data-type="front"
                    onclick="changeMainImage(this)"
                    loading="lazy"
                >

                <!-- Image verso en miniature (si elle existe) -->
                {% if product.back_image %}
                    <img 
                        src="{{ product.get_back_image_url }}" 
                        alt="{{ product.name }} - verso"
                        class="thumbnail"
                        data-full="{{ product.get_back_image_url }}"
                        data-type="back"
                        onclick="changeMainImage(this)"
                        loading="lazy"
                        title="Cliquez pour voir le verso"
                    >
                {% endif %}

                <!-- Toutes les images supplémentaires -->
                {% for img in product.gallery_images.all %}
                    <img 
                        src="{{ img.get_image_url }}" 
                        alt="{{ img.alt_text|default:product.name }}"
                        class="thumbnail"
                        data-full="{{ img.get_image_url }}"
                        onclick="changeMainImage(this)"
                        loading="lazy"
                    >
                {% endfor %}
            </div>

            <!-- Légende des images -->
            {% if product.back_image %}
                <div class="image-legend">
                    <span>
                        <span class="legend-dot legend-front"></span>
                        Recto
                    </span>
                    <span>
                        <span class="legend-dot legend-back"></span>
                        Verso (survolez l'image)
                    </span>
                </div>
            {% endif %}
        </div>

        <!-- Product Info -->
        <div class="product-details">
            <h1 class="product-title">{{ product.name }}</h1>

            <div class="product-meta">
                <span class="category-badge">{{ product.category.name }}</span>
                <span class="product-type">{{ product.get_product_type_display }}</span>
                {% if product.back_image %}
                    <span class="back-image-badge" style="background-color: #D4AF37; color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                        <i class="fas fa-sync-alt"></i> Vue recto/verso
                    </span>
                {% endif %}
            </div>

            <div class="product-rating-section">
                <div class="stars">
                    {% if product.rating >= 1 %}<i class="fas fa-star"></i>{% endif %}
                    {% if product.rating >= 2 %}<i class="fas fa-star"></i>{% endif %}
                    {% if product.rating >= 3 %}<i class="fas fa-star"></i>{% endif %}
                    {% if product.rating >= 4 %}<i class="fas fa-star"></i>{% endif %}
                    {% if product.rating >= 5 %}<i class="fas fa-star"></i>{% endif %}
                    {% if product.rating < 5 %}
                        {% for i in "x"|rjust:"5" %}
                            {% if forloop.counter > product.rating %}<i class="far fa-star"></i>{% endif %}
                        {% endfor %}
                    {% endif %}
                </div>
                <span class="rating-number">{{ product.rating }}/5</span>
                <span class="review-count">({{ product.reviews.count }} avis)</span>
            </div>

            <div class="product-pricing">
                {% if product.discount_percent %}
                    <div class="price-row">
                        <span class="label">Prix original :</span>
                        <span class="original-price">{{ product.price }}€</span>
                    </div>
                    <div class="price-row highlighted">
                        <span class="label">Prix réduit :</span>
                        <span class="sale-price">{{ product.sale_price }}€</span>
                        <span class="discount">-{{ product.discount_percent }}%</span>
                    </div>
                {% else %}
                    <div class="price-row highlighted">
                        <span class="label">Prix :</span>
                        <span class="current-price">{{ product.price }}€</span>
                    </div>
                {% endif %}
            </div>

            <p class="product-description">{{ product.description }}</p>

            <div class="product-stock">
                {% if product.display_stock %}
                    {% if product.stock > 0 %}
                        <span class="in-stock">
                            <i class="fas fa-check-circle" style="color: #2bb704; font-weight: bold;"></i> En stock
                        </span>
                    {% else %}
                        <span class="out-of-stock">
                            <i class="fas fa-times-circle" style="color: #d60404; font-weight: bold;"></i> Rupture de stock
                        </span>
                    {% endif %}
                {% else %}
                    <span class="stock-hidden" style="color: #caba08; font-weight: bold;">Disponible sur commande</span>
                {% endif %}
            </div>

            <!-- Add to Cart Form -->
            <form class="add-to-cart-form" method="post">
                {% csrf_token %}
                <div class="quantity-selector">
                    <label for="quantity">Quantité :</label>
                    <div class="quantity-input">
                        <button type="button" class="qty-btn" id="decreaseQty">-</button>
                        <input type="number" id="quantity" name="quantity" value="1" min="1" max="{{ product.stock }}" readonly>
                        <button type="button" class="qty-btn" id="increaseQty">+</button>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="button" class="btn-add-cart" id="addToCartBtn" {% if product.stock == 0 %}disabled{% endif %}>
                        <i class="fas fa-shopping-cart"></i> Ajouter au panier
                    </button>
                    <button type="button" class="btn-wishlist" id="addToWishlistBtn">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
            </form>

            <!-- Product Features -->
            <div class="product-features">
                <div class="feature">
                    <i class="fas fa-truck"></i>
                    <div>
                        <strong>Livraison gratuite</strong>
                        <p>À partir de 50€</p>
                    </div>
                </div>
                <div class="feature">
                    <i class="fas fa-shield-alt"></i>
                    <div>
                        <strong>Paiement sécurisé</strong>
                        <p>SSL 256-bit</p>
                    </div>
                </div>
                <div class="feature">
                    <i class="fas fa-undo"></i>
                    <div>
                        <strong>Retours gratuits</strong>
                        <p>30 jours</p>
                    </div>
                </div>
                {% if product.back_image %}
                <div class="feature">
                    <i class="fas fa-sync-alt"></i>
                    <div>
                        <strong>Vue 360°</strong>
                        <p>Recto & verso</p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Reviews Section -->
    <div class="reviews-section">
        <h2>Avis Clients ({{ product.reviews.count }})</h2>

        <!-- Formulaire pour ajouter un avis -->
        {% if user.is_authenticated %}
            {% if not has_reviewed %}
                <div class="review-form-container">
                    <h3>Donnez votre avis</h3>
                    <p class="review-invite">Votre expérience compte ! Partagez-la avec les autres acheteurs.</p>
                    
                    <form method="post" action="{% url 'add_review' product.id %}" class="review-form" id="reviewForm">
                        {% csrf_token %}
                        
                        <!-- Sélecteur d'étoiles interactif -->
                        <div class="star-rating-container">
                            <div class="star-rating" id="starRating">
                                <input type="hidden" name="rating" id="rating-value" value="0">
                                {% for i in "12345" %}
                                    <span class="star" data-value="{{ forloop.counter }}">★</span>
                                {% endfor %}
                            </div>
                            <span id="rating-text">Sélectionnez une note</span>
                        </div>

                        <!-- Titre optionnel -->
                        <div class="form-group">
                            <label for="id_title">Titre de votre avis (optionnel)</label>
                            {{ review_form.title }}
                        </div>

                        <!-- Zone de commentaire -->
                        <div class="form-group comment-area">
                            <label for="id_comment">Votre avis</label>
                            <textarea 
                                name="comment" 
                                id="id_comment"
                                rows="8" 
                                placeholder="Votre avis ici... (qualité, goût, emballage, livraison, rapport qualité/prix...)"
                                required
                            ></textarea>
                        </div>

                        <button type="submit" class="btn-submit-review" id="submitReviewBtn">Publier mon avis</button>
                    </form>
                </div>
            {% else %}
                <p class="already-reviewed">Vous avez déjà donné votre avis sur ce produit. Merci !</p>
            {% endif %}
        {% else %}
            <p class="login-to-review">
                <a href="{% url 'login' %}?next={{ request.path }}">Connectez-vous</a> 
                pour laisser votre avis.
            </p>
        {% endif %}

        <!-- Liste des avis -->
        <div class="reviews-list">
            {% for review in reviews %}
                <div class="review-item">
                    <div class="review-header">
                        <div class="review-rating">
                            {% for i in "12345" %}
                                <i class="fa{% if forloop.counter <= review.rating %}s{% else %}r{% endif %} fa-star"></i>
                            {% endfor %}
                            <span class="rating-number">({{ review.rating }}/5)</span>
                        </div>
                        {% if review.is_verified %}
                            <span class="verified-badge">
                                <i class="fas fa-check-circle"></i> Achat vérifié
                            </span>
                        {% endif %}
                    </div>

                    {% if review.title %}
                        <h4 class="review-title">{{ review.title }}</h4>
                    {% endif %}
                    
                    <p class="review-comment">{{ review.comment|linebreaks }}</p>
                    
                    <div class="review-meta">
                        <span class="review-author">Par {{ review.user.get_full_name|default:review.user.username }}</span>
                        <span class="review-date">{{ review.created_at|date:"d M Y" }}</span>
                    </div>
                </div>
            {% empty %}
                <div class="no-reviews">
                    <p>Aucun avis pour le moment. Soyez le premier à partager votre expérience !</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Related Products -->
    {% if related_products %}
        <div class="related-products">
            <h2>Produits similaires</h2>
            <div class="related-grid">
                {% for related in related_products %}
                    <div class="related-card">
                        <div class="related-image">
                            {% if related.image %}
                                <div class="product-image-hover-container" style="height: 150px;">
                                    <div class="product-image-hover {% if related.back_image %}has-back-image{% endif %}">
                                        <img src="{{ related.get_image_url }}" alt="{{ related.name }}" class="front-image">
                                        {% if related.back_image %}
                                            <img src="{{ related.get_back_image_url }}" alt="{{ related.name }} - verso" class="back-image">
                                        {% endif %}
                                    </div>
                                </div>
                            {% else %}
                                <div class="image-placeholder">
                                    <i class="fas fa-image"></i>
                                </div>
                            {% endif %}
                        </div>
                        <h4>{{ related.name }}</h4>
                        <p class="related-price">{{ related.price }}€</p>
                        <a href="{% url 'product_detail' related.id %}" class="btn-view-related">Voir</a>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
</div>

<style>
    .product-detail-page {
        padding: 30px 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .breadcrumb {
        margin-bottom: 30px;
        font-size: 14px;
        color: #666;
    }

    .breadcrumb a {
        color: #D4AF37;
        text-decoration: none;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }

    .product-detail-wrapper {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin-bottom: 60px;
        background: white;
        padding: 30px;
        border-radius: 8px;
    }

    /* Product Gallery Styles */
    .product-gallery {
        max-width: 500px;
        margin: 0 auto;
    }

    .thumbnails {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .thumbnail {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 6px;
        border: 2px solid #eee;
        cursor: pointer;
        transition: all 0.25s;
    }

    .thumbnail.active,
    .thumbnail:hover {
        border-color: #D4AF37;
        transform: scale(1.08);
    }

    .thumbnail[data-type="back"] {
        border-style: dashed;
        border-color: #D4AF37;
    }

    .image-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 60px;
        color: #DDD;
    }

    .product-details {
        display: flex;
        flex-direction: column;
    }

    .product-title {
        font-size: 32px;
        font-weight: 700;
        color: #5D4037;
        margin: 0 0 15px 0;
    }

    .product-meta {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
        align-items: center;
    }

    .category-badge, .product-type {
        display: inline-block;
        background-color: #FFF8E1;
        color: #5D4037;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }

    .product-rating-section {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
    }

    .stars {
        color: #D4AF37;
        font-size: 14px;
    }

    .rating-number {
        font-weight: 600;
        color: #5D4037;
    }

    .review-count {
        color: #999;
        font-size: 14px;
    }

    .product-pricing {
        background-color: #FFF8E1;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .price-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        align-items: center;
    }

    .price-row:last-child {
        margin-bottom: 0;
    }

    .price-row.highlighted {
        background-color: white;
        padding: 10px;
        border-radius: 4px;
    }

    .label {
        font-weight: 600;
        color: #5D4037;
    }

    .original-price {
        text-decoration: line-through;
        color: #999;
        font-size: 14px;
    }

    .sale-price, .current-price {
        font-size: 24px;
        font-weight: 700;
        color: #D32F2F;
    }

    .discount {
        background-color: #D32F2F;
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
    }

    .product-description {
        color: #666;
        line-height: 1.6;
        margin-bottom: 20px;
    }

    .product-stock {
        margin-bottom: 20px;
        font-size: 14px;
    }

    .in-stock {
        color: #4CAF50;
        font-weight: 600;
    }

    .out-of-stock {
        color: #D32F2F;
        font-weight: 600;
    }

    .quantity-selector {
        margin-bottom: 20px;
    }

    .quantity-selector label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #5D4037;
    }

    .quantity-input {
        display: flex;
        align-items: center;
        border: 1px solid #DDD;
        border-radius: 4px;
        width: fit-content;
    }

    .qty-btn {
        width: 40px;
        height: 40px;
        border: none;
        background-color: #F5F5F5;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s;
    }

    .qty-btn:hover {
        background-color: #E0E0E0;
    }

    #quantity {
        width: 60px;
        height: 40px;
        border: none;
        text-align: center;
        font-weight: 600;
    }

    .action-buttons {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        margin-bottom: 20px;
    }

    .btn-add-cart {
        background: linear-gradient(135deg, #5D4037 0%, #4E342E 100%);
        color: white;
        padding: 14px 20px;
        border: none;
        border-radius: 4px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: all 0.3s;
    }

    .btn-add-cart:hover:not(:disabled) {
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        transform: translateY(-2px);
    }

    .btn-add-cart:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-wishlist {
        width: 48px;
        height: 48px;
        border: 2px solid #D4AF37;
        border-radius: 4px;
        background-color: white;
        color: #D4AF37;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-wishlist:hover {
        background-color: #FFF8E1;
    }

    .product-features {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
    }

    .feature {
        display: flex;
        gap: 15px;
        padding: 15px;
        background-color: #F5F5F5;
        border-radius: 4px;
    }

    .feature i {
        font-size: 24px;
        color: #D4AF37;
    }

    .feature strong {
        display: block;
        margin-bottom: 5px;
        color: #5D4037;
    }

    .feature p {
        font-size: 12px;
        color: #999;
        margin: 0;
    }

    /* Related Products */
    .related-products {
        background: white;
        padding: 30px;
        border-radius: 8px;
    }

    .related-products h2 {
        color: #5D4037;
        margin-bottom: 20px;
    }

    .related-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 20px;
    }

    .related-card {
        text-align: center;
        padding: 15px;
    }

    .related-image {
        width: 100%;
        height: 150px;
        background-color: #F5F5F5;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 10px;
    }

    .related-image .product-image-hover-container {
        margin-bottom: 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .related-card h4 {
        color: #5D4037;
        margin: 10px 0;
        font-size: 14px;
        height: 40px;
        overflow: hidden;
    }

    .related-price {
        color: #D4AF37;
        font-weight: 700;
        margin-bottom: 10px;
        font-size: 14px;
    }

    .btn-view-related {
        display: inline-block;
        background-color: #D4AF37;
        color: #5D4037;
        padding: 8px 15px;
        border-radius: 4px;
        text-decoration: none;
        font-weight: 600;
        font-size: 12px;
        transition: background-color 0.3s;
    }

    .btn-view-related:hover {
        background-color: #C4A027;
    }

    @media (max-width: 768px) {
        .product-detail-wrapper {
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .product-image-hover-container {
            height: 300px;
        }

        .product-title {
            font-size: 24px;
        }

        .product-features {
            grid-template-columns: 1fr;
        }

        .related-grid {
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }

        .related-image .product-image-hover-container {
            height: 120px;
        }
    }

    @media (max-width: 480px) {
        .product-image-hover-container {
            height: 250px;
        }
        
        .hover-indicator {
            font-size: 10px;
            padding: 4px 8px;
        }
    }
</style>

<script>
    function changeMainImage(thumb) {
        const mainImg = document.getElementById('mainProductImage');
        mainImg.src = thumb.dataset.full;
        
        // Mettre à jour la classe active
        document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
        thumb.classList.add('active');
        
        // Si on clique sur l'image verso, on l'affiche directement
        if (thumb.dataset.type === 'back') {
            const productImageHover = document.querySelector('.product-image-hover');
            if (productImageHover) {
                const frontImg = productImageHover.querySelector('.front-image');
                const backImg = productImageHover.querySelector('.back-image');
                if (frontImg && backImg) {
                    frontImg.style.opacity = '0';
                    frontImg.style.transform = 'translateY(-20px)';
                    backImg.style.opacity = '1';
                    backImg.style.transform = 'translateY(0)';
                }
            }
        }
    }

    // Réinitialiser l'effet hover quand on clique ailleurs
    document.querySelectorAll('.thumbnail').forEach(thumb => {
        thumb.addEventListener('click', function() {
            if (this.dataset.type !== 'back') {
                const productImageHover = document.querySelector('.product-image-hover');
                if (productImageHover) {
                    const frontImg = productImageHover.querySelector('.front-image');
                    const backImg = productImageHover.querySelector('.back-image');
                    if (frontImg && backImg) {
                        frontImg.style.opacity = '1';
                        frontImg.style.transform = 'translateY(0)';
                        backImg.style.opacity = '0';
                        backImg.style.transform = 'translateY(20px)';
                    }
                }
            }
        });
    });

    document.getElementById('increaseQty').addEventListener('click', function() {
        let qty = parseInt(document.getElementById('quantity').value);
        let max = parseInt(document.getElementById('quantity').max);
        if (qty < max) {
            document.getElementById('quantity').value = qty + 1;
        }
    });

    document.getElementById('decreaseQty').addEventListener('click', function() {
        let qty = parseInt(document.getElementById('quantity').value);
        if (qty > 1) {
            document.getElementById('quantity').value = qty - 1;
        }
    });

    document.getElementById('addToCartBtn').addEventListener('click', function() {
        let productId = '{{ product.id }}';
        let quantity = document.getElementById('quantity').value;
        // Add to cart logic here
        alert('Ajouté au panier !');
    });

    document.getElementById('addToWishlistBtn').addEventListener('click', function() {
        this.classList.toggle('active');
        this.querySelector('i').classList.toggle('fas');
        this.querySelector('i').classList.toggle('far');
    });

    // Touche sur mobile pour voir le verso (tap and hold)
    let touchTimer;
    const productImageHover = document.querySelector('.product-image-hover.has-back-image');
    if (productImageHover) {
        productImageHover.addEventListener('touchstart', function(e) {
            touchTimer = setTimeout(() => {
                const frontImg = this.querySelector('.front-image');
                const backImg = this.querySelector('.back-image');
                if (frontImg && backImg) {
                    frontImg.style.opacity = '0';
                    frontImg.style.transform = 'translateY(-20px)';
                    backImg.style.opacity = '1';
                    backImg.style.transform = 'translateY(0)';
                }
                e.preventDefault();
            }, 500);
        });

        productImageHover.addEventListener('touchend', function() {
            clearTimeout(touchTimer);
        });

        productImageHover.addEventListener('touchmove', function() {
            clearTimeout(touchTimer);
        });

        // Retour à l'image recto quand on clique/tap
        productImageHover.addEventListener('click', function(e) {
            const frontImg = this.querySelector('.front-image');
            const backImg = this.querySelector('.back-image');
            if (frontImg && backImg) {
                if (backImg.style.opacity === '1') {
                    frontImg.style.opacity = '1';
                    frontImg.style.transform = 'translateY(0)';
                    backImg.style.opacity = '0';
                    backImg.style.transform = 'translateY(20px)';
                }
            }
        });
    }
</script>

{% endblock %}